<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f16" />
  <title>要件定義書｜Monster Duel</title>
  <meta name="description" content="モンスター対戦ゲーム（仮） 要件定義書。目的、画面構成、データ仕様、バトルルール、演出、UI要件、フィードバック、ファイル構成、画面オブジェクト、開発者ガイド、検討事項、変更履歴。">
  <link rel="stylesheet" href="../assets/css/site.css" />
  <style>
    /* ---- 読みやすさ向上（内容は一切変更しません） ---- */
    .req-wrap { max-width: 1040px; margin: 0 auto; padding: min(6vw, 32px); }
    .req-hero { position: sticky; top: 0; z-index: 20; padding: 10px 0;
      background: linear-gradient(180deg, rgba(11,15,22,.92), rgba(11,15,22,.65));
      backdrop-filter: blur(6px);
      border-bottom: 1px solid var(--border);
    }
    .req-head { display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .req-title { margin: 0; }
    .chip { display:inline-block; padding:.2rem .6rem; border:1px solid var(--border); border-radius:999px; background:var(--glass); font-size:.8rem; color:var(--muted) }
    .toc { display:grid; gap:.6rem; }
    .toc a { display:block; padding:.55rem .75rem; border:1px solid var(--border); border-radius:10px; background:var(--glass); color:var(--muted); text-decoration:none }
    .toc a:hover { color:#fff; border-color:#5bb8ff; }
    .sec { margin-top: 18px; }
    .card+.card { margin-top: 12px; }
    .subtle { color: var(--muted); }
    .kbd { font-family: ui-monospace, Menlo, Consolas, monospace; font-size: .95em; }
    details.req { border:1px solid var(--border); border-radius:12px; overflow:hidden; background:var(--glass); }
    details.req > summary { list-style:none; cursor:pointer; padding:.9rem 1rem; font-weight:700; }
    details.req[open] > summary { border-bottom:1px solid var(--border); background: rgba(255,255,255,.02); }
    details.req .box { padding: .9rem 1rem; }
    .grid-2 { display:grid; gap:12px; }
    @media (min-width: 980px){ .grid-2 { grid-template-columns: 1fr 1fr; } }
    .top-btn { position:fixed; right:16px; bottom:16px; z-index:40 }
    .list-tight li { margin:.35rem 0; }
    .lead { font-size:1.05rem; color:var(--muted); }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <a class="brand" href="../" aria-label="トップへ">
      <span class="brand__logo" aria-hidden="true">★</span>
      <span class="brand__text">Monster Duel</span>
    </a>
    <button class="nav-toggle" aria-expanded="false" aria-controls="nav">MENU</button>
    <nav id="nav" class="nav" aria-expanded="false">
      <a href="../demo.html">デモ</a>
      <a href="../concept/">世界観</a>
      <a href="../pages/monsters.html">モンスター</a>
      <a href="../pages/moves.html">技</a>
      <a href="../pages/type-chart.html">相性表</a>
      <a href="../concept/overall.html">コンセプト</a>
      <a href="./">要件定義</a>
      <a href="../changelog.html">更新情報</a>
    </nav>
  </header>

  <!-- Sticky page header -->
  <div class="req-hero">
    <div class="req-wrap req-head">
      <h1 class="req-title">モンスター対戦（仮） 要件定義書</h1>
      <span class="chip">ドキュメント</span>
    </div>
  </div>

  <main class="req-wrap">
    <!-- 目次 -->
    <section class="section">
      <div class="card">
        <strong class="chip">目次</strong>
        <nav id="toc" class="toc" aria-label="目次">
          <!-- JSで自動生成 -->
        </nav>
        <p class="subtle" style="margin-top:.5rem">※ 各セクションはクリックで開閉できます。内容は原文をそのまま収録しています。</p>
      </div>
    </section>

    <!-- 0. ゲームタイトル -->
    <section id="sec-0" class="sec">
      <details class="req" open>
        <summary>0. ゲームタイトル</summary>
        <div class="box">
          <ul class="list-tight">
            <li>本ゲームのタイトルは「モンスター対戦（仮）」とする。</li>
          </ul>
        </div>
      </details>
    </section>

    <!-- 1. 目的 -->
    <section id="sec-1" class="sec">
      <details class="req" open>
        <summary>1. 目的</summary>
        <div class="box">
          <ul class="list-tight">
            <li>ブラウザで動作するゲームを試作し、実際にプレイヤーに遊んでもらう。</li>
            <li>ゲームの訴求点や駆け引きの面白さを体験ベースで説明・検証する。</li>
            <li>プレイヤーからフィードバックを集め、ゲームシステムをブラッシュアップする。</li>
          </ul>
        </div>
      </details>
    </section>

    <!-- 2. 画面構成と要件 -->
    <section id="sec-2" class="sec">
      <details class="req" open>
        <summary>2. 画面構成と要件</summary>
        <div class="box grid-2">
          <div class="card">
            <h3>2.1 開始画面</h3>
            <ul class="list-tight">
              <li>画面名表示：「開始画面」ヘッダーを画面上部に常時表示。</li>
              <li>タイトル表示：ゲームタイトル「モンスター対戦（仮）」を中央に表示。</li>
              <li>選択ボタン：「▶ モンスターを選ぶ」を押すとモンスター選択画面へ遷移。</li>
              <li>説明ウインドウ：ゲーム概要や記事リンクを表示。読み専用。</li>
              <li>戻るボタン：不要。</li>
            </ul>
          </div>
          <div class="card">
            <h3>2.2 モンスター選択画面</h3>
            <ul class="list-tight">
              <li>画面名表示：「モンスター選択画面」ヘッダーを画面上部に常時表示。</li>
              <li>相手候補6体：表示専用。クリック操作不可。</li>
              <li>プレイヤー選択：全モンスターから3体をクリックで選択/解除。</li>
              <li>カウンター：選択数 (n/3) を表示。</li>
              <li>技ボタン：「技を選ぶ」を押すと技選択画面へ遷移。3体選択後のみ有効化。</li>
              <li>属性表：簡易マトリクス（〇/△/×表記、全属性一覧）を表示。読み専用。</li>
              <li>ガイドボタン：「おすすめを見る」を押すとガイドメッセージを表示。</li>
              <li>説明ウインドウ：画面の目的や戦略ヒントを表示。読み専用。</li>
              <li>戻るボタン：開始画面に戻る。選択状態保持あり。</li>
            </ul>
          </div>
          <div class="card">
            <h3>2.3 技選択画面</h3>
            <ul class="list-tight">
              <li>画面名表示：「技選択画面」ヘッダーを画面上部に常時表示。</li>
              <li>候補6体表示：相手候補を表示。読み専用。</li>
              <li>プレイヤー3体：選んだ3体を表示。クリックで技セット切替。</li>
              <li>技リスト：各技をクリックで選択。属性/威力/消費ST表示。</li>
              <li>選択済みリスト：セット済み技を表示。クリックで解除可能。</li>
              <li>必須条件：各モンスターに4つ技をセットしないと遷移不可。</li>
              <li>自動遷移：未完了モンスターがある場合、自動で当該モンスターへ移動し警告を表示。</li>
              <li>バトルへ：3体すべて技セット完了時のみ有効。クリックでバトル画面へ。</li>
              <li>説明ウインドウ：技選択の注意を表示。「ちょうど4つ選んでください」ガイダンスを常時表示。</li>
              <li>戻るボタン：モンスター選択画面へ戻る。状態保持あり。</li>
            </ul>
          </div>
          <div class="card">
            <h3>2.4 バトル画面</h3>
            <ul class="list-tight">
              <li>画面名表示：「バトル画面」ヘッダーを画面上部に常時表示。</li>
              <li>ステータス表示：
                <ul>
                  <li>味方モンスター：HP・ST（ゲージ）および能力値（ATK/DEF/MAG/SPD 等）を表示する。</li>
                  <li>相手モンスター：HP と能力値のみを表示し、ST は画面上に表示しない（内部管理のみ）。</li>
                </ul>
              </li>
              <li>技ボタン：セットした4技をクリックで行動選択。ST不足は無効。</li>
              <li>交代ボタン：他のモンスターに交代可能。</li>
              <li>降参ボタン：クリックで即時敗北。確認なし。</li>
              <li>技情報：技名・威力・消費ST・属性マークを表示。相性が良い場合「〇」、不利は「×」。補正後の威力も表示（例: 10→20）。</li>
              <li>ログ：行動履歴を表示。読み専用。</li>
              <li>リスタート：クリックで開始画面に戻る。初期化あり。</li>
              <li>説明ウインドウ：バトル操作の説明を表示。</li>
            </ul>
          </div>
        </div>
      </details>
    </section>

    <!-- 3. データ仕様 -->
    <section id="sec-3" class="sec">
      <details class="req" open>
        <summary>3. データ仕様</summary>
        <div class="box">
          <ul class="list-tight">
            <li>モンスター：HP、ST、ATK、DEF、MAG、SPD、属性（炎/水/風/土/雷/氷/光/闇）、内部ID。</li>
            <li>技：技名、タイプ（物理/魔法/補助）、威力、消費ST、属性（任意）。属性一致で威力2倍。</li>
          </ul>
        </div>
      </details>
    </section>

    <!-- 4. バトルルール -->
    <section id="sec-4" class="sec">
      <details class="req" open>
        <summary>4. バトルルール</summary>
        <div class="box">
          <ul class="list-tight">
            <li>ターン制コマンドバトル。</li>
            <li>行動順：SPD高い方が先攻。同値はランダム。</li>
            <li>ダメージ計算式：dmg = floor(base × STAB × 相性 × 乱数)。</li>
            <li>base = floor(pow × (10+攻撃)/(10+防御))。</li>
            <li>STAB=2.0、相性=1.5/1.0/0.5、乱数=0.85〜1.00。</li>
              <li>ST不足技は選択不可。「ガード」は次の被ダメージ半減。</li>
              <li>スタミナ（ST）仕様：
                <ul>
                  <li>ダメージを受けるたびに該当モンスターの ST を 10 減少させる。
                    <ul>
                      <li>もし ST が不足する場合（受けるべき ST 減少量が現在の ST を超える場合）、不足分は自動的に HP から差し引かれる（HP で補填）。</li>
                      <li>弱点属性（相性が有利）による攻撃を受けた場合、該当ダメージに伴う ST の消費は 2 倍 とする（例：通常 -10 → -20）。</li>
                    </ul>
                  </li>
                  <li>ST が 0 になると、フロントにいる味方または相手のステータス表示が赤く点滅する演出を行う（UI 表示のみ、内部状態としては ST=0）。</li>
                  <li>バックにいるモンスターは、ターン終了時に ST を回復する。回復量は最大 ST の 1%（ただし最低 1 を保証）とする。</li>
                </ul>
              </li>
              <li>連続攻撃（マルチヒット）：
                <ul>
                  <li>連続攻撃はヒット数を持つ（例：2ヒット、3ヒット）。</li>
                  <li>ヒット回数ごとに相手の ST を消費する。消費量は 10 × ヒット数（例：3ヒットであれば 30 消費）。</li>
                  <li>ダメージは各ヒットごとに個別に計算し、合計して適用する。各ヒットで ST の減少や弱点による ST 倍率は個別に適用される（例：弱点ヒットが混在する場合、該当ヒットごとに ST 消費が 2 倍）。</li>
                  <li>各ヒットが個別に ST を枯渇させる可能性があるため、ヒットごとに ST の残量チェックを行い、不足が発生した場合はそのヒット分の不足分を HP で補填する処理を行う。</li>
                </ul>
              </li>
              <li>相性例：炎>氷、水>炎/土、風>土、土>雷、雷>水、氷>風、光↔闇。</li>
          </ul>
        </div>
      </details>
    </section>

    <!-- 5. 攻撃演出 -->
    <section id="sec-5" class="sec">
      <details class="req" open>
        <summary>5. 攻撃演出</summary>
        <div class="box">
          <ul class="list-tight">
            <li>攻撃時にカードが光る/拡大する。</li>
            <li>属性ごとの飛び道具エフェクト。</li>
            <li>ヒット時の専用演出（爆発、水しぶき等）。</li>
            <li>大ダメージ時はシェイク演出。</li>
            <li>実装：CSSアニメーション簡易版、将来はCanvas等リッチ演出。</li>
          </ul>
        </div>
      </details>
    </section>

    <!-- 6. UI共通要件 -->
    <section id="sec-6" class="sec">
      <details class="req" open>
        <summary>6. UI共通要件</summary>
        <div class="box">
          <ul class="list-tight">
            <li>説明ウインドウ：全画面下部に常時表示。</li>
            <li>戻るボタン：下部中央に配置。状態保持あり。</li>
            <li>画面名：上部に常時表示。</li>
            <li>スマホ最適化：誤タップ防止。</li>
          </ul>
        </div>
      </details>
    </section>

    <!-- 7. フィードバック要件 -->
    <section id="sec-7" class="sec">
      <details class="req" open>
        <summary>7. フィードバック要件</summary>
        <div class="box">
          <ul class="list-tight">
            <li>バトル終了時に感謝とコメント促しメッセージを表示。</li>
            <li>リスタートで非表示。</li>
          </ul>
        </div>
      </details>
    </section>

    <!-- 8. ファイル構成 -->
    <section id="sec-8" class="sec">
      <details class="req" open>
        <summary>8. ファイル構成</summary>
        <div class="box">
          <p class="lead">プロジェクトの主要フォルダとファイル（ルートからの階層を示します）：</p>
          <ul class="list-tight">
            <li>ルート/
              <ul>
                <li><strong>demo.html</strong>：ゲーム全体の画面遷移とUI構造を記述。</li>
                <li><strong>index.html</strong>：サイトトップ（説明やリンク）。</li>
                <li><strong>README.md</strong>：プロジェクト概要と開発手順。</li>
                <li><strong>changelog.html</strong>：更新履歴。</li>
                <li><strong>robots.txt / sitemap.xml</strong>：公開用メタ情報。</li>
                <li><strong>styles.css</strong>：グローバルなスタイル（補助的）。</li>
                <li>assets/
                  <ul>
                    <li>css/
                      <ul>
                        <li><strong>site.css</strong>：共通レイアウト・テーマスタイル。</li>
                      </ul>
                    </li>
                    <li>js/
                      <ul>
                        <li><strong>main.js</strong>：画面遷移・共通UI制御・データロード。</li>
                        <li><strong>mon-spotlight.js</strong>：モンスター表示・スポットライト処理。</li>
                        <li><strong>render-monsters.js</strong>：モンスターカード描画ロジック。</li>
                        <li><strong>render-moves.js</strong>：技リスト描画ロジック。</li>
                        <li><strong>trailer.js</strong>：紹介用トレーラーの制御。</li>
                        <li><strong>type-chart.js</strong>：属性相性表のロジック。</li>
                      </ul>
                    </li>
                    <li>media/
                      <ul>
                        <li><strong>trailer.mp4</strong>：プロモーション動画。</li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li>concept/
                  <ul>
                    <li><strong>index.html</strong>：世界観トップ。</li>
                    <li><strong>battle.html</strong>：バトルの考え方や仕様。</li>
                    <li><strong>growth.html</strong>：育成・成長要素の説明。</li>
                    <li><strong>overall.html</strong>：全体コンセプト。</li>
                  </ul>
                </li>
                <li>data/
                  <ul>
                    <li><strong>monsters.json</strong>：モンスターデータ（HP, ATK, 属性等）。</li>
                    <li><strong>moves.json</strong>：技データ（威力、消費ST、属性）。</li>
                    <li><strong>types.json</strong>：属性定義・相性表。</li>
                    <li><strong>version.json</strong>：データ版管理。</li>
                  </ul>
                </li>
                <li>docs/
                  <ul>
                    <li><strong>requirements.md</strong>：要件定義（このHTML版の元ファイル）。</li>
                  </ul>
                </li>
                <li>pages/
                  <ul>
                    <li><strong>monsters.html</strong>：公開用モンスター一覧ページ。</li>
                    <li><strong>moves.html</strong>：公開用技一覧ページ。</li>
                    <li><strong>type-chart.html</strong>：公開用相性表。</li>
                  </ul>
                </li>
                <li>requirements/
                  <ul>
                    <li><strong>gameplay.html</strong>：要件定義のHTML版（現在のファイル）。</li>
                    <li><strong>index.html</strong>：要件ドキュメントの目次。</li>
                    <li><strong>roadmap.html</strong>：開発ロードマップ。</li>
                    <li><strong>system.html</strong>：システム要件・技術スタック。</li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </details>
    </section>

    <!-- 9. 画面オブジェクト一覧 -->
    <section id="sec-9" class="sec">
      <details class="req" open>
        <summary>9. 画面オブジェクト一覧</summary>
        <div class="box grid-2">
          <div class="card">
            <h3>開始画面</h3>
            <ul class="list-tight">
              <li>タイトル：読み専用。</li>
              <li>モンスター選ぶボタン：クリックでモンスター選択画面へ。</li>
              <li>説明ウインドウ：読み専用。</li>
            </ul>
          </div>
          <div class="card">
            <h3>モンスター選択画面</h3>
            <ul class="list-tight">
              <li>相手候補カード：読み専用。</li>
              <li>プレイヤーカード：クリックで選択/解除。</li>
              <li>カウンター：自動更新。</li>
              <li>技を選ぶボタン：クリックで技選択画面へ。</li>
              <li>属性表：読み専用。</li>
              <li>おすすめボタン：クリックでガイド表示。</li>
            </ul>
          </div>
          <div class="card">
            <h3>技選択画面</h3>
            <ul class="list-tight">
              <li>候補表示：読み専用。</li>
              <li>技リスト：クリックで技を選択。</li>
              <li>選択済みリスト：クリックで解除。</li>
              <li>バトルへボタン：クリックでバトル画面へ。</li>
            </ul>
          </div>
          <div class="card">
            <h3>バトル画面</h3>
            <ul class="list-tight">
              <li>ステータス表示：読み専用。
                <ul>
                  <li>味方：HP・ST・能力値を表示する。</li>
                  <li>相手：HP・能力値のみ表示し、ST は非表示とする。</li>
                </ul>
              </li>
              <li>技ボタン：クリックで行動選択。</li>
              <li>交代ボタン：クリックでモンスター交代。</li>
              <li>降参ボタン：クリックで即終了。</li>
              <li>ログ：読み専用。</li>
              <li>リスタート：クリックで開始画面へ。</li>
            </ul>
          </div>
        </div>
      </details>
    </section>

    <!-- 10. 開発者ガイド -->
    <section id="sec-10" class="sec">
      <details class="req" open>
        <summary>10. 開発者ガイド</summary>
        <div class="box">
          <ul class="list-tight">
            <li>HTMLはdemo.htmlに集約し、画面構成をsectionで分割する。</li>
            <li>CSSは画面ごとに分割して管理し、可読性と保守性を高める。</li>
            <li>JSは役割ごとに分割：main.jsはUI制御、battle.jsはバトルロジック。</li>
            <li>データはmonsters.jsとskills.jsに分離し、拡張性を確保。</li>
            <li>今後の変更時は変更履歴を追記し、上から新しい順に記録。</li>
          </ul>
        </div>
      </details>
    </section>

    <!-- (Sections 11 and 12 removed) -->
  </main>

  <footer class="site-footer">
    <p>© <span id="year"></span> Monster Duel Project</p>
  </footer>

  <!-- 上部へ戻る -->
  <a class="btn btn--primary top-btn" href="#top" aria-label="トップへ戻る">▲</a>

  <script src="../assets/js/main.js" defer></script>
  <script>
    // ===== 目次の自動生成（H2=各大項目） =====
    document.addEventListener('DOMContentLoaded', () => {
      const toc = document.getElementById('toc');
      const sections = Array.from(document.querySelectorAll('main section[id]'));
      const frag = document.createDocumentFragment();
      sections.forEach(sec => {
        const h2 = sec.querySelector('summary') || sec.querySelector('h2');
        if(!h2) return;
        const a = document.createElement('a');
        a.href = `#${sec.id}`;
        a.textContent = h2.textContent.replace(/\s*#\s*$/, '');
        frag.appendChild(a);
      });
      toc.appendChild(frag);
    });
  </script>
</body>
</html>
